<!DOCTYPE HTML>
<html>

<head>
  <meta charset="UTF-8">
  <title>What the F*cculent</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
  <link rel="stylesheet" href"https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
  <section id="navbar">
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">What the F*cculent?</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" aria-current="page" href="index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="identification.html">Identification</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="plantcare.html">Plant Care</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="about.html">About Us</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
  </section>

  <form>
    <input type="file" multiple />
    <!-- <button type="button">OK</button> -->
    <button id="clickbutton">Okay</button>
  </form>

  <script type="text/javascript">

  document.getElementById("clickbutton").addEventListener("click", function(event){
    event.preventDefault();
    sendIdentification();
  });

  function sendIdentification() {
      const files = [...document.querySelector('input[type=file]').files];
      const promises = files.map((file) => {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (event) => {
              const res = event.target.result;
              console.log(res);
              resolve(res);
            }
            reader.readAsDataURL(file)
        })
      })

      Promise.all(promises).then((base64files) => {
        console.log(base64files)

        const data = {
          api_key: "m7DriNpPXZgdYme3E78Wo7wovP8eEtqhhHHArGL6ePAnlQgc24",
          images: base64files,
          modifiers: ["crops_fast", "similar_images"],
          plant_language: "en",
          plant_details: ["common_names",
                            "url",
                            "name_authority",
                            "wiki_description",
                            "taxonomy",
                            "synonyms"]
        };

        fetch('https://api.plant.id/v2/identify', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data),
        })
        .then(response => response.json())
        .then(data => {
          console.log('Success:', data);
        })
        .catch((error) => {
          console.error('Error:', error);
        });
      })
  };

  </script>

</body>
</html>
